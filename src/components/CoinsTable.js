// This is a React component called CoinsTable that displays a table of cryptocurrency prices sorted by market cap. It allows users to search for specific cryptocurrencies and provides pagination for easy navigation.

// Here's a summary of how the component works:


import React, { useState } from "react";
import { makeStyles } from "@material-ui/core/styles";
import Pagination from "@material-ui/lab/Pagination";
import {
  Container,
  createTheme,
  TableCell,
  LinearProgress,
  ThemeProvider,
  Typography,
  TextField,
  TableBody,
  TableRow,
  TableHead,
  TableContainer,
  Table,
  Paper,
} from "@material-ui/core";
import { useHistory } from "react-router-dom";
import { CryptoState } from "../CryptoContext";



export function numberWithCommas(x) {
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
}

export default function CoinsTable() {
  const [search, setSearch] = useState("");
  const [page, setPage] = useState(1);

  const { symbol, coins, loading } = CryptoState();

  // The component defines state variables search and page using the useState hook. search will hold the search input value, and page will hold the current page number for pagination.

// It uses the CryptoState context to access data related to cryptocurrency symbols (symbol), the list of cryptocurrencies (coins), and a loading indicator (loading).

  const useStyles = makeStyles({
    row: {
      backgroundColor: "#16171a",
      cursor: "pointer",
      "&:hover": {
        backgroundColor: "#131111",
      },
      fontFamily: "Montserrat",
    },
    pagination: {
      "& .MuiPaginationItem-root": {
        color: "gold",
      },
    },
  });

// The component defines custom styles for rows and the pagination using the makeStyles hook.

  const classes = useStyles();
  const history = useHistory();

  const darkTheme = createTheme({
    palette: {
      primary: {
        main: "#fff",
      },
      type: "dark",
    },
  });
// A dark theme is created using createTheme from Material-UI.

  const handleSearch = () => {
    return coins.filter(
      (coin) =>
        coin.name.toLowerCase().includes(search) ||
        coin.symbol.toLowerCase().includes(search)
    );
  };

  return (
    <ThemeProvider theme={darkTheme}>
      <Container style={{ textAlign: "center" }}>

        {/* The component renders a container (<Container style={{ textAlign: "center" }}>), a heading (<Typography>), and a search input (<TextField>). */}

        <Typography
          variant="h4"
          style={{ margin: 18, fontFamily: "Montserrat" }}
        >
          Cryptocurrency Prices by Market Cap
        </Typography>
        <TextField
          label="Search For a Crypto Currency.."
          variant="outlined"
          style={{ marginBottom: 20, width: "100%" }}
          onChange={(e) => setSearch(e.target.value)}
        />
        <TableContainer component={Paper}>
          {loading ? (
            <LinearProgress style={{ backgroundColor: "gold" }} />
          ) : (
            <Table aria-label="simple table">
              <TableHead style={{ backgroundColor: "#EEBC1D" }}>
                <TableRow>
                  {["Coin", "Price", "24h Change", "Market Cap"].map((head) => (
                    <TableCell
                      style={{
                        color: "black",
                        fontWeight: "700",
                        fontFamily: "Montserrat",
                      }}
                      key={head}
                      align={head === "Coin" ? "left" : "right"}
                    >
                      {head}
                    </TableCell>
                  ))}
                </TableRow>
              </TableHead>

              <TableBody>
                {handleSearch()
                  .slice((page - 1) * 10, (page - 1) * 10 + 10)
                  .map((row) => {
                    const profit = row.price_change_percentage_24h > 0;
                    return (
                      <TableRow
                        onClick={() => history.push(`/coins/${row.id}`)}
                        className={classes.row}
                        key={row.name}
                      >
                        <TableCell
                          component="th"
                          scope="row"
                          style={{
                            display: "flex",
                            gap: 15,
                          }}
                        >
                          <img
                            src={row?.image}
                            alt={row.name}
                            height="50"
                            style={{ marginBottom: 10 }}
                          />
                          <div
                            style={{ display: "flex", flexDirection: "column" }}
                          >
                            <span
                              style={{
                                textTransform: "uppercase",
                                fontSize: 22,
                              }}
                            >
                              {row.symbol}
                            </span>
                            <span style={{ color: "darkgrey" }}>
                              {row.name}
                            </span>
                          </div>
                        </TableCell>
                        <TableCell align="right">
                          {symbol}{" "}
                          {numberWithCommas(row.current_price.toFixed(2))}
                        </TableCell>
                        <TableCell
                          align="right"
                          style={{
                            color: profit > 0 ? "rgb(14, 203, 129)" : "red",
                            fontWeight: 500,
                          }}
                        >
                          {profit && "+"}
                          {row.price_change_percentage_24h.toFixed(2)}%
                        </TableCell>
                        <TableCell align="right">
                          {symbol}{" "}
                          {numberWithCommas(
                            row.market_cap.toString().slice(0, -6)
                          )}
                          M
                        </TableCell>
                      </TableRow>
                    );
                  })}
              </TableBody>
            </Table>
          )}
        </TableContainer>

{/* Inside the TableContainer, the component conditionally renders either a LinearProgress (loading indicator) or a Table based on the loading state.

The table displays cryptocurrency data with columns for "Coin", "Price", "24h Change", and "Market Cap". The "Coin" column contains cryptocurrency symbols and names. The "Price" column displays the current price with the currency symbol. The "24h Change" column shows the percentage change in price in the last 24 hours, with green for positive change and red for negative change. The "Market Cap" column displays the market capitalization of the cryptocurrency in millions.
 */}

{/* The table is populated by mapping through the filtered search results from the handleSearch function. The handleSearch function filters the list of cryptocurrencies based on the search input value.
*/}

{/* Each row in the table is clickable (<TableRow onClick={() => history.push(/coins/${row.id})}>), and clicking on a row will navigate the user to the detailed page of that cryptocurrency. */}

        {/* Comes from @material-ui/lab */}
        <Pagination
          count={parseInt((handleSearch()?.length / 10).toFixed(0))}
          style={{
            padding: 20,
            width: "100%",
            display: "flex",
            justifyContent: "center",
          }}
          classes={{ ul: classes.pagination }}
          onChange={(_, value) => {
            setPage(value);
            window.scroll(0, 450);
          }}
        />
      </Container>
    </ThemeProvider>
  );
        }

        // The table is paginated using the Pagination component from @material-ui/lab. The number of pages is calculated based on the number of search results, and the page state is updated when the user changes the page.

        // When the user changes the page, the onChange event of the Pagination component is triggered, and the page state is updated accordingly. The window is then scrolled to the top of the table to ensure the user sees the start of the new page.

// Overall, this CoinsTable component provides a table of cryptocurrency prices with search and pagination functionality, allowing users to easily find and browse through the list of cryptocurrencies. The table also includes a loading indicator while fetching data and links to detailed pages for each cryptocurrency.





